# CLI 用户体验改进方案

## 问题总结

从 CLI 用户的实际体验出发，发现以下问题：

### 1. 任务 ID (UUID) 问题 ❌

**当前输出**:
```
任务 ID: 725f70b6-f3a0-4cb5-a79b-017a868dba3b
状态: inbox（待处理）
优先级: medium
```

**问题**:
- UUID 对用户完全没用，只是一串乱码
- 用户无法记住或引用
- 占用屏幕空间

**解决方案**:
- 方案 A: 完全不显示 UUID
- 方案 B: 显示短 ID（如 `#1`, `#2`）+ 任务标题作为引用

### 2. Markdown 格式问题 ❌

**当前输出**:
```
1. **学习 Python 基础** (状态：待处理)
   - 描述：学习 Python 编程语言的基础知识...
```

**在 CLI 中实际显示**:
```
1. **学习 Python 基础** (状态：待处理)
   ^^^                ^^^
   这些星号会显示出来，不会真的加粗
```

**问题**:
- Markdown 语法在 CLI 中不会被渲染
- 反而增加视觉噪音
- 用户看到的是原始代码

**解决方案**:
使用纯文本 + ANSI 颜色（如果需要强调）

### 3. LLM 回复覆盖 Visualization ❌

**当前流程**:
```
1. Visualization 显示: 【✓ 任务已创建】
2. LLM 生成回复: "已创建任务：学习 Python 基础\n任务 ID: xxx\n状态: inbox..."
```

**问题**:
- Visualization 的简洁性被 LLM 的冗长回复覆盖
- 用户看到的是 LLM 的详细输出，而不是简洁的 visualization

**解决方案**:
在 skill prompt 中明确告诉 LLM：
- 工具调用后，只需简短确认
- 不要重复工具已经显示的信息

---

## 改进方案

### 方案 1: 优化 Skill Prompt（推荐）

在 `scripts/init_new_db.py` 的 todo skill prompt 中添加：

```python
"prompt_template": """## 任务管理技能（GTD 方法论）

### 任务状态
brainstorm（想法）→ inbox（待处理）→ active（进行中）→ completed（完成）
其他：waiting（等待）、someday（未来）、archived（归档）

### 核心规则
1. 用户要 1 个任务就创建 1 个，不要自作主张创建多个
2. 创建前先搜索，避免重复
3. 发现重复询问："已有相同任务，是否删除重复的？"

### CLI 输出规则（重要）
1. 工具调用后，只需简短确认，不要重复工具已显示的信息
2. 不要输出任务 ID (UUID)
3. 不要使用 Markdown 格式（**粗体**、*斜体*、`代码`）
4. 列出任务时使用纯文本格式：
   ```
   1. 学习 Python 基础
      状态: 待处理  优先级: 中
      创建: 2026-01-30

   2. 写周报
      状态: 待处理  优先级: 中
      创建: 2026-01-30
   ```

### 回复示例

❌ 错误示例:
```
已创建任务：学习 Python 基础
任务 ID: 725f70b6-f3a0-4cb5-a79b-017a868dba3b
状态: inbox（待处理）
优先级: medium
标签: 学习、编程、Python
```

✅ 正确示例:
```
已创建任务"学习 Python 基础"，状态为待处理。
```

❌ 错误示例（列表）:
```
找到 2 个任务：

1. **学习 Python 基础** (状态：待处理)
   - 描述：学习 Python 编程语言...
   - 优先级：中等
```

✅ 正确示例（列表）:
```
找到 2 个任务：

1. 学习 Python 基础
   状态: 待处理  优先级: 中
   学习 Python 编程语言的基础知识

2. 写周报
   状态: 待处理  优先级: 中
   总结本周工作内容
```
"""
```

### 方案 2: 改进 Visualization（可选）

让 visualization 显示更多信息，减少 LLM 需要补充的内容：

```python
DATABASE_OPERATION_VISUALIZATION = {
    "create_task": {
        "calling": "【创建任务：\"{title}\"】",
        "success": "【✓ 已创建：{title} | 状态: {status} | 优先级: {priority}】",
        "error": "【✗ 创建失败：{error}】"
    },
}
```

### 方案 3: 添加短 ID 系统（可选，较复杂）

为每个会话维护一个任务编号映射：
```
#1 → 学习 Python 基础
#2 → 写周报
#3 → 整理文档
```

用户可以用 `#1` 来引用任务，而不是 UUID。

---

## 实施优先级

### 立即实施（优先级 1）
1. ✅ 修改 skill prompt，添加 CLI 输出规则
2. ✅ 禁止输出 UUID
3. ✅ 禁止使用 Markdown 格式

### 短期实施（优先级 2）
4. 改进 visualization，显示更多关键信息
5. 在 BASE_AGENT_PROMPT 中也添加"不使用 Markdown"的规则

### 长期考虑（优先级 3）
6. 实现短 ID 系统（#1, #2, #3）
7. 使用 ANSI 颜色代码进行适当的强调

---

## 预期效果

### 改进前
```
👤 用户: 创建任务：学习 Python

🤖 助手: 我来帮你创建一个学习 Python 基础的任务。
首先让我搜索一下是否已经有类似的任务。
没有找到重复的任务。
现在为你创建这个任务：

已创建任务：学习 Python 基础
任务 ID: 725f70b6-f3a0-4cb5-a79b-017a868dba3b
状态: inbox（待处理）
优先级: medium
标签: 学习、编程、Python

任务已添加到待处理列表中。
```

### 改进后
```
👤 用户: 创建任务：学习 Python

【创建任务："学习 Python"】
【✓ 已创建：学习 Python | 状态: 待处理 | 优先级: 中】

🤖 助手: 已创建任务"学习 Python"，状态为待处理。
```

**改进点**:
- ✅ 去掉了冗长的过程描述
- ✅ 去掉了无用的 UUID
- ✅ Visualization 显示关键信息
- ✅ LLM 只做简短确认
- ✅ 整体更简洁清晰

---

## 下一步行动

1. 修改 `scripts/init_new_db.py` 中的 todo skill prompt
2. 重新初始化数据库
3. 运行测试验证改进效果
4. 根据测试结果进一步调整
